schemaVersion: 2.2.0
metadata:
  name: devfile-python-hello-world

components:
  - name: python
    container:
      image: python:3.11
      command:
        - sleep
      args:
        - "infinity"
      mountSources: true

commands:

  # Build → Test → App (real flow)
  - id: build-test-run
    exec:
      component: python-runtime
      commandLine: |
        python demo.py build
        python demo.py test
        python demo.py hello Devfile

  # Explicit &&
  - id: build-and-test
    exec:
      component: python-runtime
      commandLine: |
        python demo.py build && python demo.py test

  # Lint + Test
  - id: lint-and-test
    exec:
      component: python-runtime
      commandLine: |
        python demo.py lint
        python demo.py test

  # Multiline shell
  - id: run-python-multiline
    exec:
      component: python-runtime
      commandLine: |
        python \
          demo.py \
          multiline

  # Semicolon chaining
  - id: semicolon-demo
    exec:
      component: python-runtime
      commandLine: |
        python demo.py semicolon;
        python demo.py semicolon;
        python demo.py semicolon

  # Pipe example
  - id: pipe-demo
    exec:
      component: python-runtime
      commandLine: |
        python demo.py pipe | grep python | wc -w

  # OR operator
  - id: or-operator-demo
    exec:
      component: python-runtime
      commandLine: |
        python demo.py or_fail || echo "Recovered from failure"

  # Windows backslash normalization
  - id: windows-backslash-demo
    exec:
      component: python-runtime
      commandLine: |
        python \\
          demo.py \\
          windows_backslash

  # File generation + pipe + read
  - id: file-flow-demo
    exec:
      component: python-runtime
      commandLine: |
        python demo.py generate_file
        python demo.py read_file

  # Composite sequential
  - id: full-workflow
    composite:
      commands:
        - build-test-run
        - run-python-multiline
        - file-flow-demo
      parallel: false

  # Composite parallel
  - id: diagnostics-parallel
    composite:
      commands:
        - pipe-demo
        - or-operator-demo
        - semicolon-demo
      parallel: true
