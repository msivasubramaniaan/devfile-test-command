schemaVersion: 2.2.0
metadata:
  name: devfile-python-hello-world

components:
  - name: python
    container:
      image: python:3.11
      command:
        - sleep
      args:
        - "infinity"
      mountSources: true

commands:
  # 1. Simple multiline â†’ auto &&
  - id: build-test-run
    exec:
      component: python
      commandLine: |
        echo "Building project..."
        echo "Running tests..."
        python app.py Devfile

  # 2. Explicit && chaining
  - id: build-and-test
    exec:
      component: python
      commandLine: |
        echo "Building..." && echo "Testing..."

  # 3. Shell line continuation (\)
  - id: run-python-multiline
    exec:
      component: python
      commandLine: |
        python \
          app.py \
          "Muthu"

  # 4. Semicolon chaining
  - id: semicolon-demo
    exec:
      component: python
      commandLine: |
        echo Start;
        echo Middle;
        echo End

  # 5. Pipe operator
  - id: pipe-demo
    exec:
      component: python
      commandLine: |
        echo "python devfile demo" | grep python | wc -w

  # 6. OR operator
  - id: or-operator-demo
    exec:
      component: python
      commandLine: |
        false || echo "Recovered from failure"

  # 7. Single line command
  - id: run-app
    exec:
      component: python
      commandLine: python app.py

  # 8. Windows-style backslash normalization
  - id: windows-backslash-demo
    exec:
      component: python
      commandLine: |
        echo \\
          "windows" \\
          "style"

  # 9. Mixed shell syntax
  - id: mixed-shell-syntax
    exec:
      component: python
      commandLine: |
        echo "hello" | grep h;
        echo "done"

  # 10. Simple echo (baseline)
  - id: simple-echo
    exec:
      component: python
      commandLine: echo "Simple command execution"

  # 11. Composite: sequential workflow
  - id: full-workflow
    composite:
      commands:
        - build-test-run
        - run-python-multiline
        - simple-echo
      parallel: false

  # 12. Composite: parallel execution
  - id: diagnostics-parallel
    composite:
      commands:
        - pipe-demo
        - or-operator-demo
        - semicolon-demo
      parallel: true

  # 13. Composite: nested composite
  - id: complete-demo
    composite:
      commands:
        - full-workflow
        - diagnostics-parallel
        - run-app
