schemaVersion: 2.2.0
metadata:
  name: devfile-python-hello-world

components:
  - name: python
    container:
      image: python:3.11
      command:
        - sleep
      args:
        - "infinity"
      mountSources: true

commands:
  # Build → Test → App
  - id: build-test-run
    exec:
      component: python
      commandLine: |
        python -u demo.py build
        python -u demo.py test
        python -u demo.py hello Devfile

  # Explicit &&
  - id: build-and-test
    exec:
      component: python
      commandLine: |
        python -u demo.py build && python -u demo.py test

  # Lint + Test
  - id: lint-and-test
    exec:
      component: python
      commandLine: |
        python -u demo.py lint
        python -u demo.py test

  # Multiline shell ( \ continuation )
  - id: run-python-multiline
    exec:
      component: python
      commandLine: |
        python -u \
          demo.py \
          multiline

  # Semicolon chaining
  - id: semicolon-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py semicolon;
        python -u demo.py semicolon;
        python -u demo.py semicolon

  # Pipe example
  - id: pipe-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py pipe | grep "service=python" | wc -l

  # OR operator (||)
  - id: or-operator-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py or_fail || echo "Recovered from failure"

  # Windows backslash normalization (\\)
  - id: windows-backslash-demo
    exec:
      component: python
      commandLine: |
        python -u \\
          demo.py \\
          windows_backslash

  # Single line normal run
  - id: run-app
    exec:
      component: python
      commandLine: |
        python -u demo.py hello

  # Mixed shell syntax
  - id: mixed-shell-syntax
    exec:
      component: python
      commandLine: |
        python -u demo.py pipe | grep "service=python";
        echo "done"

  # Composite sequential workflow
  - id: full-workflow
    composite:
      commands:
        - build-test-run
        - run-python-multiline
        - run-app
      parallel: false

  # Composite parallel workflow
  - id: diagnostics-parallel
    composite:
      commands:
        - pipe-demo
        - or-operator-demo
        - semicolon-demo
      parallel: true
