schemaVersion: 2.2.0
metadata:
  name: devfile-python-devfile-commands

components:
  - name: python
    container:
      image: python:3.11
      command:
        - sleep
      args:
        - "infinity"
      mountSources: true

commands:

  # Newline â†’ implicit &&
  - id: generate-validate-transform
    exec:
      component: python
      commandLine: |
        python -u demo.py generate
        python -u demo.py validate
        python -u demo.py transform

  # Explicit &&
  - id: explicit-and-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py generate && python -u demo.py validate

  # OR operator
  - id: or-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py fail || echo "Recovered from failure"

  # Semicolon chaining
  - id: semicolon-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py status;
        python -u demo.py status

  # Pipe demo
  - id: pipe-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py pipe | grep "service=python" | wc -l

  # POSIX multiline using backslash (\)
  - id: posix-multiline-demo
    exec:
      component: python
      commandLine: |
        python -u \
          demo.py \
          argv \
          one \
          two \
          three

  # Windows escaped multiline (\\)
  - id: windows-multiline-demo
    exec:
      component: python
      commandLine: |
        python -u \\
          demo.py \\
          argv \\
          win \\
          style

  # Windows backslash normalization function
  - id: windows-backslash-demo
    exec:
      component: python
      commandLine: |
        python -u \\
          demo.py \\
          windows_backslash

  # Subshell grouping
  - id: subshell-demo
    exec:
      component: python
      commandLine: |
        (python -u demo.py generate && python -u demo.py validate) &&
        python -u demo.py transform

  # Background + wait
  - id: background-demo
    exec:
      component: python
      commandLine: |
        python -u demo.py pipe & python -u demo.py pipe & wait

  # Composite: sequential pipeline
  - id: full-demo
    composite:
      commands:
        - generate-validate-transform
        - pipe-demo
        - or-demo
        - posix-multiline-demo
        - windows-multiline-demo
      parallel: false

  # Composite: parallel diagnostics
  - id: diagnostics-parallel
    composite:
      commands:
        - pipe-demo
        - semicolon-demo
        - windows-backslash-demo
      parallel: true
